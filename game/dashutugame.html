<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ja">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		<meta name="referrer" content="origin-when-crossorigin">
		<meta name="referrer" content="origin-when-cross-origin">
		<link rel="stylesheet" type="text/css" href="dashutu.css">
		<title>脱出ゲーム</title>
		<script type="text/javascript">
		if(location.protocol == 'http:'){
			location.replace(location.href.replace(/^http:/, 'https:'));
		}
		</script>
		<script type="text/javascript" src="escapegame.js"></script>
		<script type="text/javascript">
			var esc = new EscapeGame();
			esc.addPreLoadImages( ['images/gameover1.png'] );
			var flag = [];
			var $$ = function( id ){ return document.getElementById( id ); };
			esc.addScenes( ['nowloading', 'title', 'sea', 'beach', 'forest',  'house','open_bottle','closed_bottle','filled_bottle', 'letter', 'alcoholletter','smokecandle','kindled_smokecandle', 'alcohol','open_firstaidkit','closed_firstaidkit', 'ome','over'] );
			
			(function()
			{
				var load = function()
				{
					esc.setMessageBox( 'messagebox' );
					
					var turnSea = function()
					{
						esc.changeScene( 'sea' );
						esc.message( '海だ。', 1000 );
					};
					var turnBeach = function()
					{
						esc.changeScene( 'beach' );
						esc.message( '海岸だ。', 1000 );
					};
					var turnForest = function()
					{
						esc.changeScene( 'forest' );
						esc.message( '森だ。', 1000 );
					};
					var turnHouse = function()
					{
						esc.changeScene( 'house' );
						esc.message( '小屋の中にいる。', 1000 );
					};
					
					var turnOpen_firstaidkit = function()
					{
						esc.changeScene( 'open_firstaidkit' );
						esc.message( '救急箱だ。', 1000 );
					};
					
					var turnClosed_firstaidkit = function()
					{
						esc.changeScene( 'closed_firstaidkit' );
						esc.message( '救急箱だ。', 1000 );
					};
					
					var back = function()
					{
						esc.backScene();
					};
					
					
					//sea
					esc.setTrigger( 'sea_left_trigger', turnBeach );
					esc.setTrigger( 'sea_right_trigger', turnForest );
					esc.setTrigger( 'deguchi', function(){esc.changeScene('ome');} );//クリア
					
					//beach
					esc.setTrigger( 'beach_left_trigger', turnForest );
					esc.setTrigger( 'beach_right_trigger', turnSea );


					// bottle is clicked
					esc.setTrigger( 'closed_bottle1',
						function()
						{
							flag['closed_bottle1'] = true;
							$$('item_closed_bottle').style.display='block';
							$$('item_closed_bottle').style.visibility = 'inherit';
							$$('closed_bottle1').style.visibility = 'hidden';
							esc.message( 'ボトルを拾った',3000 );

						}
					);
					
					//forest
					esc.setTrigger( 'forest_left_trigger', turnSea );
					esc.setTrigger( 'forest_right_trigger', turnBeach );
					esc.setTrigger( 'forest_previous_trigger', turnHouse );
					
					//house
					esc.setTrigger( 'house_down_trigger', turnForest );
					esc.setTrigger( 'house_door', turnHouse);
					esc.setTrigger( 'dynamite', function()
						{
							
							$$('item_dynamite').style.display='block';
							$$('item_dynamite').style.visibility = 'inherit';
							$$('dynamite').style.visibility = 'hidden';
							esc.message( 'ダイナマイトを拾った',3000 );

						});
					//TableCards
					esc.setTrigger( 'table_down_trigger', back );

					esc.setTrigger( 'rakugaki_down_trigger', back );

					esc.setTrigger( 'box_down_trigger', back );
					esc.setForm( 'box_form', 'HdHboveYPaSGhX62q3B1BGMg', 'JavaScriptで脱出ゲーム テスト1', 16,
						function()
						{
							if( flag['box_open'] ) return;
							flag['box_open'] = true;
							esc.message( '開いた', 3000 );
							$( 'box' ).style.backgroundPosition = '0px -1884px';
							$( 'redkey' ).style.visibility = 'inherit';
						},
						function()
						{
							if( flag['box_open'] ) return;
							esc.message( '……', 3000 );
						}
					);
					
					esc.setTrigger( 'start',
						function()
						{
							esc.changeScene('sea');
						}
					);
					
					//タイトルへ
					esc.setTrigger( 'go_title',
						function()
						{
							
							// 初期化する
							esc.restartAllDrag();
							esc.restartAllForm();
							esc.message( '' );
							flag = [];
							$$('item_closed_bottle').style.visibility = 'hidden';
							$$('closed_bottle1').style.visibility = 'inherit';
							$$('item_dynamite').style.visibility = 'hidden';
							esc.changeScene( 'title' );
						}
					);
					
					esc.ifLoadComplete( function(){ esc.changeScene('title'); } );
				};
				
				if( window.addEventListener )
				{
					window.addEventListener( 'load', load, false );
				}
				else if( window.attachEvent )
				{
					window.attachEvent( 'on'+'load', load );
				}

				load = null; // なんとなく
			})();

			//TimeOut
			function timeOut(){
				function getTimeRemaining(endtime) {
					var t = Date.parse(endtime) - Date.parse(new Date());
					var seconds = Math.floor((t / 1000) % 60);
					var minutes = Math.floor((t / 1000 / 60) % 60);

					return {
						'total': t,
						'minutes': minutes,
						'seconds': seconds
					};
				}
				function isTime(){
					alert("TimeOut");
					esc.changeScene( 'over' );
				}

				function initializeClock(id, endtime) {
				var clock = document.getElementById(id);
				var minutesSpan = clock.querySelector('.minutes');
				var secondsSpan = clock.querySelector('.seconds');

					function updateClock() {
						var t = getTimeRemaining(endtime);

						minutesSpan.innerHTML = ('0' + t.minutes).slice(-2);
						secondsSpan.innerHTML = ('0' + t.seconds).slice(-2);

						if (t.total <= 0) {
						clearInterval(timeinterval);
						isTime();
						}
					}

					updateClock();
					var timeinterval = setInterval(updateClock, 1000);
				}

				var deadline = new Date(Date.parse(new Date()) +  5 * 60 * 1000);
				initializeClock('clockdiv', deadline);
			}

			function popupImage() {
			var popup = document.getElementById('js-popup');
			if(!popup) return;

			var blackBg = document.getElementById('js-black-bg');

			var blackBg = document.getElementById('js-black-bg');
			var closeBtn = document.getElementById('js-close-btn');
			var showBtn = document.getElementById('js-show-popup');

			closePopUp(blackBg);
			closePopUp(closeBtn);
			closePopUp(showBtn);
			function closePopUp(elem) {
				if(!elem) return;
				elem.addEventListener('click', function() {
				popup.classList.toggle('is-show');
				});
			}
			}
			popupImage();
			
			//モーダルid
			var m_id=null;

			function bordernune(){
				$$('item_closed_bottle').style.border = 'none';
				$$('item_open_bottle').style.border = 'none';
				$$('item_letter').style.border = 'none';
				$$('item_alcohol').style.border = 'none';
				$$('item_filled_bottle').style.border = 'none';
				$$('item_alcohol_letter').style.border = 'none';
				$$('item_dynamite').style.border = 'none';
			}

			function setMid(m_img){
				m_id=m_img;
				console.log(m_id);

				bordernune()

				switch(m_id){
					case "cbm":
					$$('item_closed_bottle').style.border = 'solid';
					$$('item_zoom').style.display = 'inherit';
					console.log(m_id+'クリック');
					break;
					
					case "opm":
					$$('item_open_bottle').style.border = 'solid';
					$$('item_zoom').style.display = 'inherit';
					console.log(m_id+'クリック');
					break;

					case "lm":
					$$('item_letter').style.border = 'solid';
					$$('item_zoom').style.display = 'inherit';
					console.log(m_id+'クリック');
					break;

					case "am":
					$$('item_alcohol').style.border = 'solid';
					$$('item_zoom').style.display = 'inherit';
					console.log(m_id+'クリック');
					break;

					case "fbm":
					$$('item_filled_bottle').style.border = 'solid';
					$$('item_zoom').style.display = 'inherit';
					console.log(m_id+'クリック');
					break;

					case "alm":
					$$('item_alcohol_letter').style.border = 'solid';
					$$('item_zoom').style.display = 'inherit';
					console.log(m_id+'クリック');
					break;

					case "dm":
					$$('item_dynamite').style.border = 'solid';
					$$('item_zoom').style.display = 'inherit';
					console.log(m_id+'クリック');
					break;
				}
			}

			function itemModal(){
				console.log(m_id+'外');
				

				switch(m_id){
					case "cbm":
					$$('modal_closed_bottle').style.display = 'inherit';
					$$('item_closed_bottle').style.border = 'hidden';
					$$('item_zoom').style.display = 'none';
					$$('close_modal').style.display = 'inherit';
					console.log(m_id+'中');
					break;
					
					case "opm":
					$$('modal_open_bottle').style.display = 'inherit';
					$$('item_open_bottle').style.border = 'hidden';
					$$('item_zoom').style.display = 'none';
					$$('close_modal').style.display = 'inherit';
					console.log(m_id+'中');
					break;

					case "lm":
					$$('modal_letter').style.display = 'inherit';
					$$('item_letter').style.border = 'hidden';
					$$('item_zoom').style.display = 'none';
					$$('close_modal').style.display = 'inherit';
					console.log(m_id+'中');
					break;

					case "am":
					$$('modal_alcohol').style.display = 'inherit';
					$$('item_alcohol').style.border = 'hidden';
					$$('item_zoom').style.display = 'none';
					$$('close_modal').style.display = 'inherit';
					console.log(m_id+'中');
					break;

					case "fbm":
					$$('modal_filled_bottle').style.display = 'inherit';
					$$('item_filled_bottle').style.border = 'hidden';
					$$('item_zoom').style.display = 'none';
					$$('close_modal').style.display = 'inherit';
					console.log(m_id+'中');
					break;

					case "alm":
					$$('modal_alcohol_letter').style.display = 'inherit';
					$$('item_alcohol_letter').style.border = 'hidden';
					$$('item_zoom').style.display = 'none';
					$$('close_modal').style.display = 'inherit';
					console.log(m_id+'中');
					break;

					case "dm":
					$$('modal_dynamite').style.display = 'inherit';
					$$('item_dynamite').style.border = 'hidden';
					$$('item_zoom').style.display = 'none';
					$$('close_modal').style.display = 'inherit';
					console.log(m_id+'中');
					break;
				}
				m_id=null;
				console.log(m_id+'外');
			}

			function eraseimg(){
				$$('close_modal').style.display = 'none';
				$$('modal_closed_bottle').style.display = 'none';
				$$('modal_open_bottle').style.display = 'none';
				$$('modal_letter').style.display = 'none';
				$$('modal_alcohol').style.display = 'none';
				$$('modal_filled_bottle').style.display = 'none';
				$$('modal_alcohol_letter').style.display = 'none';
				$$('modal_dynamite').style.display = 'none';
			}

			//アイテム変化用
			//一つから他へ変化
			function ItemChange(){
				//closed_bottleからの変化
				if(m_id=="modal_closed_bottle"){
					$$('modal_closed_bottle').style.display = 'none';
					$$('item_closed_bottle').style.display = 'hidden';
					$$('item_open_bottle').style.display = 'inherit';
					$$('item_letter').style.display = 'inherit';
				}
			}

			//二つを一つに変化
			function ItemChange(item_id){
				if(m_id==""&&item_id==""){}
			}
		</script>

	</head>
	<body>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script type="text/javascript" src="images.js"></script>
		<h1 style="text-align:center;font-family:aqua_pfont,'あくあＰフォント',aquafont,'あくあフォント';">無人島からの脱出</h1>

		<div id="timespace">
		<center>
			<div id="clockdiv">
			<div>
				<span class="minutes"></span>
				<div class="smalltext">分</div>
			</div>
			<div>
				<span class="seconds"></span>
				<div class="smalltext">秒</div>
			</div>
			</div>
		</center>
		</div>

		<div id="escapegame_main" unselectable="on" onselectstart="return false">

		<div id="nowloading">Now Loading....</div>
		<!--アイテムボックス-->
		<div id="itembox_outer1">
			<div id="itembox_outer2">
				<div id="itembox">
					<div id="item_closed_bottle"  onclick="setMid('cbm')"></div>
					<div id="item_open_bottle"  onclick="setMid('opm')"></div>
					<div id="item_letter"  onclick="setMid('lm')"></div>
					<div id="item_alcohol"  onclick="setMid('am')"></div>
					<div id="item_filled_bottle" onclick="setMid('fbm')"></div>
					<div id="item_alcohol_letter" onclick="setMid('alm')"></div>
					<div id="item_dynamite"  onclick="setMid('dm')"></div>
					<div id="item_zoom" class="js-modal-open" onclick="itemModal()"></div>
					<div id="close_modal" class="js-modal-close" onclick="eraseimg()"></div>
				</div>
			</div>
		</div>
		<!--メッセージボックス-->
		<div id="messagebox_outer1">
			<div id="messagebox_outer2">
				<div id="messagebox">JavaScriptを使っています。無効にしている場合は有効にしないと遊べません。</div>
			</div>
		</div>

		<div id="title" class="scene">
			<div id="start" onClick="timeOut()"></div>
		</div>
		<!-- Sea -->
		<div id="sea" class="scene">
			<div id="sea_left_trigger" class="left_arrow"></div>
			<div id="sea_right_trigger" class="right_arrow"></div>
			<div id="closed_bottle1"></div>
		</div>
		<!-- Beach -->
		<div id="beach" class="scene">
			<div id="beach_left_trigger" class="left_arrow"></div>
			<div id="beach_right_trigger" class="right_arrow"></div>
		</div>
		<!-- Forest -->
		<div id="forest" class="scene">
			<div id="forest_left_trigger" class="left_arrow"></div>
			<div id="forest_right_trigger" class="right_arrow"></div>
			<div id="forest_previous_trigger" class="up_arrow"></div>
			<div id="house_door"></div>

		</div>
		<!-- House's inside -->
		<div id="house" class="scene">
			<div id="house_down_trigger" class="down_arrow"></div>
			<div id="tips_small"></div>
			<div id="box_small"></div>
			<div id="dynamite"></div>
		</div>

		<div id="box" class="scene">
			<div id="redkey"></div>
			<form id="box_form">
				<input class="text" type="text" value="" maxlength="8" unselectable="off" onselectstart="return true" />
				<br/>
				<input class="button" type="reset" value="Clear">
				<input class="button" type="submit" value="Enter">
			</form>
			<div id="box_down_trigger" class="down_arrow"></div>
		</div>

		<div id="over" class="scene">
		<div id="go_title"></div>
		</div>
		<!--アイテム拡大に使える-->
			<div id="modal_scene" class="modal js-modal">
				<div class="modal__bg"></div>
				<div class="modal__content">
					<div id="modal_closed_bottle"></div>
					<div id="modal_open_bottle"></div>
					<div id="modal_letter"></div>
					<div id="modal_alcohol"></div>
					<div id="modal_filled_bottle"></div>
					<div id="modal_alcohol_letter"></div>
					<div id="modal_dynamite"></div>
				</div><!--modal__inner-->
			</div><!--modal-->
		</div>
	</body>
</html>